<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø®ØªØ¨Ø§Ø± JHTM - Ù…ÙØµÙ„</title>
    <style>
        body { font-family: Arial; padding: 20px; direction: rtl; }
        .box { border: 1px solid #ccc; padding: 15px; margin: 10px 0; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f4f4f4; padding: 10px; overflow: auto; max-height: 300px; }
        h3 { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± JHTM Ù…ÙØµÙ„</h1>

    <div id="step1" class="box info">
        <h3>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø©</h3>
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>

    <div id="step2" class="box info">
        <h3>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <p>ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
    </div>

    <div id="step3" class="box info">
        <h3>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ù…Ø¹Ø§Ù„Ø¬Ø© @include</h3>
        <p>ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
    </div>

    <div id="step4" class="box info">
        <h3>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
        <div id="result">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
    </div>

    <div class="box">
        <h3>ğŸ“„ Ù…Ø¹Ø§ÙŠÙ†Ø© HTML:</h3>
        <pre id="preview"></pre>
    </div>

    <script src="../jhtm.js"></script>
    <script>
        function updateStep(step, status, message) {
            const div = document.getElementById(step);
            div.className = 'box ' + status;
            div.querySelector('p, div').innerHTML = message;
        }

        console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...');

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1
        if (typeof JHTM !== 'undefined') {
            updateStep('step1', 'success', 'âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ JHTM Ø¨Ù†Ø¬Ø§Ø­<br>Ø§Ù„Ù†Ø³Ø®Ø©: ' + (JHTM.version || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
        } else {
            updateStep('step1', 'error', 'âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ JHTM');
        }

        // Ø¥Ù†Ø´Ø§Ø¡ instance
        const jhtm = new JHTM('template.html', 'data.json', {
            templateBasePath: './partials',
            cacheTemplate: false,
            cacheData: false
        });

        updateStep('step2', 'info', 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

        // ØªØ´ØºÙŠÙ„ render
        jhtm.render()
            .then(result => {
                console.log('âœ… Ù†Ø¬Ø­ render()');
                console.log('Ø§Ù„Ù†ØªÙŠØ¬Ø©:', result);

                updateStep('step2', 'success', 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');

                // ÙØ­Øµ @include
                const hasInclude = result.includes('@include(');
                if (hasInclude) {
                    updateStep('step3', 'error',
                        'âŒ @include Ù„Ù… ØªØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡!<br>' +
                        'Ø¹Ø¯Ø¯ @include Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ' + (result.match(/@include/g) || []).length
                    );
                } else {
                    updateStep('step3', 'success', 'âœ… ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© @include Ø¨Ù†Ø¬Ø§Ø­');
                }

                // ÙØ­Øµ Ù…Ø­ØªÙˆÙ‰ header
                const hasHeader = result.includes('Ù‡Ø°Ø§ Ø§Ù„Ù‡ÙŠØ¯Ø± Ù…Ù† Ù…Ù„Ù Ø®Ø§Ø±Ø¬ÙŠ');
                const hasTitle = result.includes('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ');

                let resultMsg = '';
                if (hasHeader) {
                    resultMsg += 'âœ… ØªÙ… Ø¬Ù„Ø¨ header.html<br>';
                } else {
                    resultMsg += 'âŒ Ù„Ù… ÙŠØªÙ… Ø¬Ù„Ø¨ header.html<br>';
                }

                if (hasTitle) {
                    resultMsg += 'âœ… ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª {{title}}<br>';
                } else {
                    resultMsg += 'âŒ Ù„Ù… ØªØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª<br>';
                }

                resultMsg += '<br>Ø·ÙˆÙ„ HTML: ' + result.length + ' Ø­Ø±Ù';

                updateStep('step4', hasHeader && hasTitle ? 'success' : 'error', resultMsg);

                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                document.getElementById('preview').textContent = result;

                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                document.getElementById('result').innerHTML =
                    '<iframe srcdoc="' + result.replace(/"/g, '&quot;') +
                    '" style="width:100%; height:300px; border:1px solid #ccc;"></iframe>';
            })
            .catch(error => {
                console.error('âŒ Ø®Ø·Ø£:', error);
                updateStep('step2', 'error', 'âŒ Ø®Ø·Ø£: ' + error.message);
                updateStep('step3', 'error', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°');
                updateStep('step4', 'error',
                    'âŒ ÙØ´Ù„:<br><pre>' + error.stack + '</pre>'
                );
            });
    </script>
</body>
</html>
